<ion-header class="ion-no-border">
  <ion-toolbar class="cabecera-oscura">
    <ion-title color="light">Mi Perfil</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrarSesion()" color="danger">
        <ion-icon slot="icon-only" name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="fondo-app">
  <div class="contenedor-principal" *ngIf="perfil">
    
    <ion-card class="tarjeta-modulo" style="text-align: center; padding: 20px;">
      <img [src]="avatarUrl" style="width: 120px; height: 120px; border-radius: 50%; margin: 0 auto; border: 3px solid #4ade80;">
      <h2 style="color: white; text-transform: uppercase; font-weight: bold; margin-top: 15px;">{{ perfil.username }}</h2>
      <ion-badge color="warning" style="font-size: 1.1rem; padding: 8px;">{{ perfil.points }} Puntos Globales</ion-badge>
      
      <div style="margin-top: 15px;">
        <ion-button size="small" color="light" fill="outline" (click)="cambiarAvatar()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Cambiar Avatar
        </ion-button>
      </div>

      <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px;">
        <div style="color: #4ade80;"><strong>{{ estadisticas.acertadas }}</strong> Acertadas</div>
        <div style="color: #f87171;"><strong>{{ estadisticas.falladas }}</strong> Falladas</div>
      </div>
    </ion-card>

    <h2 style="color: white; margin-top: 20px; font-size: 1.2rem;">Historial de Apuestas</h2>
    
    <ion-card class="tarjeta-modulo" *ngIf="perfil.bets && perfil.bets.length > 0; else sinApuestas">
      <ion-list style="background: transparent;">
        <ion-item *ngFor="let apuesta of perfil.bets" color="dark" lines="full">
          <ion-icon name="ticket-outline" slot="start" [color]="apuesta.pointsEarned > 0 ? 'success' : 'medium'"></ion-icon>
          <ion-label style="color: white;">
            <h2>Partido #{{ apuesta.matchId }}</h2>
            <p style="color: #a0aec0;">Pron√≥stico: {{ apuesta.homeScore }} - {{ apuesta.awayScore }}</p>
          </ion-label>
          <ion-badge slot="end" [color]="apuesta.pointsEarned === 10 ? 'success' : (apuesta.pointsEarned === 5 ? 'warning' : 'medium')">
            +{{ apuesta.pointsEarned || 0 }} pts
          </ion-badge>
        </ion-item>
      </ion-list>
    </ion-card>

    <ng-template #sinApuestas>
      <p style="color: #a0aec0; text-align: center; margin-top: 20px;">No hay historial de apuestas.</p>
    </ng-template>

  </div>
</ion-content>